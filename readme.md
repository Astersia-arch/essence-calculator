```
# 终末地武器基质刷取规划器

智能分组算法，动态适配任意CSV表头。

## 功能

- **动态列适配**：自动读取 `weapons.csv` 表头，左侧显示全部列，右侧仅展示前3列（通常为类别/稀有度/名称）
- **智能筛选**：基于前3列自动生成筛选下拉框，支持关键词实时搜索
- **双表操作**：
  - 左侧：全列展示，多选（Ctrl/Shift）后点击添加或双击单条添加
  - 右侧：精简3列显示，支持多选删除、Delete键快捷删除、一键清空
- **策略计算**：贪心算法自动分组，底部横跨显示完整策略（区域/主属性/固定词条/次数/武器列表）
- **自动导出**：结果实时保存为 `res.csv`（UTF-8-SIG编码，Excel可直接打开）

## 文件格式

### weapons.csv
- **编码**：UTF-8
- **要求列**：必须包含 `名称`、`主属性`、`附加属性`、`技能` 用于计算（程序通过列名识别）
- **其他列**：任意数量列均可，前3列将自动作为左侧筛选条件和右侧展示列
- **示例**：
  ```csv
  类别,稀有度,名称,主属性,附加属性,技能,备注
  单手剑,5,钢铁余音,敏捷,物理,巧技,测试数据
  单手剑,6,坚城铸造者,智识/力量,终结,昂扬,
  ```

### area.csv
- **必需列**：`区域`、`附加属性1~8`、`技能1~8`
- **可选列**：`成本`（数值，默认1.0，如武陵城设为7.0）
- **示例**：
  ```csv
  区域,附加属性1,...,附加属性8,技能1,...,技能8,成本
  枢纽区,攻击,灼热,...,流转,效益,...,效益,1.0
  武陵城,电磁,寒冷,...,压制,追袭,...,爆发,7.0
  ```

## 使用

1. **准备文件**：确保 `weapons.csv` 和 `area.csv` 与程序同目录
2. **启动**：`python main.py`
3. **选择武器**：
   - **筛选**：左上区域通过前3列下拉框或搜索框快速定位
   - **添加**：左侧表格多选后点击"➡ 添加选中"，或直接双击单条
   - **管理**：右侧表格显示前3列，可多选后点击"⬅ 删除选中"或按 Delete 键，"⚠ 清空全部"移除所有
4. **计算**：点击底部"🚀 开始计算策略"，下方表格显示策略详情（区域、主属性、固定词条、次数、覆盖武器列表）
5. **导出**：结果自动保存为 `res.csv`

## 界面布局

```
┌─────────────────────┬─────────────────────┐
│     武器库（全列）   │   已选武器（前3列）  │
│  [筛选: 列1] [列2]  │                     │
│  类别 稀有度 名称... │   类别 稀有度 名称   │
│  单手剑 5 钢铁余音   │   单手剑 5 钢铁余音  │
│  ...                │   ...               │
│  [➡ 添加选中]       │  [⬅ 删除] [清空全部] │
└─────────────────────┴─────────────────────┘
┌───────────────────────────────────────────┐
│              刷取策略                      │
│  区域 | 主属性1-3 | 附加/技能 | 次数 | 武器列表 │
│  枢纽区 | 力量 敏捷 智识 | 灼热 随机 | 12 | 钢铁余音;利剑风暴... │
└───────────────────────────────────────────┘
```

## 算法简述

1. **统计频率**：统计剩余武器的附加属性与技能出现频率（按稀有度加权）
2. **属性固定**：选择覆盖最多武器的属性进行固定（附加属性或技能二选一）
3. **区域匹配**：选择兼容性最高且成本最低的区域（兼容性 = 包含的副属性数量 / 成本倍率）
4. **主属性选择**：提取该组武器主属性的Top-3高频项
5. **次数计算**：基于主属性排列组合数与95%置信度计算所需刷取次数
6. **迭代**：移除已覆盖武器，重复直至全部分配

## 依赖

- Python 3.9+
- pandas
- tkinter（Python标准库）

```bash
pip install pandas
```

```
