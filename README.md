# 终末地武器基质刷取规划器使用文档

## 简介

终末地武器基质刷取规划器是一个专门为游戏《明日方舟：终末地》设计的刷取优化工具。它可以帮助玩家规划武器基质的刷取策略，通过智能分组和区域匹配，减少更换词条的次数，以最低成本为多个武器刷取基质。

## 主要功能

1. **武器属性自动匹配**：从武器库中自动查找指定武器的属性
2. **智能分组优化**：将具有相似属性的武器分组，减少刷取策略切换
3. **区域匹配**：自动寻找最适合刷取每组武器的区域
4. **成本优化**：考虑不同区域的刷取成本差异（武陵城成本为7倍）
5. **策略输出**：生成详细的刷取策略表，包括区域、主属性、附加属性/技能和刷取次数

## 文件结构

### 必需文件

```
项目目录/
├── main.py    # 主程序文件
├── test.txt            # 需要刷取基质的武器列表
├── wqsx.txt           # 武器属性数据库
└── jz.txt            # 区域属性数据
```

### 可选输出文件
```
项目目录/
└── res.csv            # 生成的刷取策略（程序运行后生成）
```

## 文件格式说明

### 1. test.txt
- **功能**：指定需要刷取基质的武器名称列表
- **格式**：每行一个武器名称
- **示例**：
```
赫拉芬格
探骊
O.B.J.迅极
```

### 2. wqsx.txt
- **功能**：武器属性数据库，包含所有武器的完整属性信息
- **格式**：制表符分隔的文本文件（TSV）
- **必需列**：
  - `类别`：武器类型（如单手剑、双手剑等）
  - `稀有度`：武器星级（如5、6）
  - `名称`：武器名称
  - `主属性`：武器的主属性（力量、敏捷、智识、意志、主能力）
  - `附加属性`：武器的附加属性
  - `技能`：武器的技能属性
- **示例**：
```
类别	稀有度	名称	主属性	附加属性	技能
单手剑	5	钢铁余音	敏捷	物理	巧技
单手剑	5	坚城铸造者	智识	终结	昂扬
```

### 3. jz.txt
- **功能**：区域属性数据，定义每个区域可刷取的属性范围
- **格式**：制表符分隔的文本文件（TSV）
- **必需列**：
  - `区域`：区域名称
  - `附加属性1`~`附加属性8`：该区域可刷取的8个附加属性
  - `技能1`~`技能8`：该区域可刷取的8个技能
- **示例**：
```
区域	附加属性1	附加属性2	附加属性3	附加属性4	附加属性5	附加属性6	附加属性7	附加属性8	技能1	技能2	技能3	技能4	技能5	技能6	技能7	技能8
枢纽区	攻击	灼热	电磁	寒冷	自然	源石	终结技	法术	强攻	压制	追袭	粉碎	巧技	迸发	流转	效益
```

## 安装与运行

### 环境要求
- Python 3.6 或更高版本
- 以下Python库：
  - pandas

### 安装依赖
```bash
pip install pandas
```

### 运行程序
1. 将程序文件和所有必需文件放在同一目录下
2. 打开命令行终端
3. 运行以下命令：
```bash
python main.py
```

## 使用步骤

### 步骤1：准备输入文件
1. 创建或编辑 `test.txt`，列出所有需要刷取基质的武器名称
2. 确保 `wqsx.txt` 包含所有武器的属性信息
3. 确保 `jz.txt` 包含所有区域的属性数据

### 步骤2：运行程序
```bash
python main.py
```

### 步骤3：查看输出
程序运行后会：
1. 在控制台显示处理过程
2. 显示每个步骤的决策过程
3. 输出最终的刷取策略
4. 将详细策略保存到 `res.csv` 文件

### 步骤4：执行刷取策略
按照 `res.csv` 文件中的策略在游戏中执行刷取操作

## 输出文件格式

### res.csv 文件格式
- **区域**：推荐的刷取区域
- **主属性1**：第一个主属性选择
- **主属性2**：第二个主属性选择
- **主属性3**：第三个主属性选择
- **附加属性**：固定的附加属性（如果为"随机"，则表示不固定）
- **技能**：固定的技能（如果为"随机"，则表示不固定）
- **次数**：建议的刷取次数

**注意**：每条策略中，附加属性和技能必须有一个是"随机"。

### 输出示例
```
区域,主属性1,主属性2,主属性3,附加属性,技能,次数
枢纽区,力量,敏捷,智识,灼热,随机,12
枢纽区,智识,意志,主能力,随机,强攻,8
```

## 算法原理

### 1. 属性频率统计
程序首先统计所有武器的附加属性和技能出现频率，从高频属性开始尝试分组。

### 2. 智能分组
基于属性频率，将具有相同高频属性的武器分为一组，优先考虑能够覆盖更多武器的属性。

### 3. 区域匹配
为每组武器寻找合适的刷取区域，考虑以下因素：
- 武器所需的所有附加属性是否在该区域可用
- 武器所需的所有技能是否在该区域可用
- 主属性数量是否超过3个（超过需要选择最重要的3个）
- 区域刷取成本（武陵城成本为7倍）

### 4. 成本计算
根据每组武器的数量和属性分布，计算需要的刷取次数：
- 每次刷取获得2个基质
- 每个主属性组合需要足够的刷取次数以确保高概率获得
- 应用区域成本权重

### 5. 迭代分配
重复上述过程，直到所有武器都被分配到合适的策略中。

## 高级用法

### 调整优化参数
在代码中可以调整以下参数：
- `region_cost`：区域成本权重
- 分组策略的优先级（技能优先或附加属性优先）
- 主属性选择策略

### 调试模式
程序默认显示详细的处理过程，包括：
- 剩余未分配武器数量
- 属性频率统计
- 区域匹配尝试结果
- 每次分组的决策

## 常见问题

### Q1：程序提示"在wqsx.txt中未找到"某些武器
A：检查武器名称是否完全匹配，包括标点符号和空格。

### Q2：生成的策略次数过多
A：这是正常的，程序基于概率模型计算确保高成功率（约95%）。

### Q3：为什么有些策略的附加属性或技能是"随机"？
A：根据游戏机制，每次刷取只能固定一个属性类型（附加属性或技能），另一个必须随机。

### Q4：能否调整成功率目标？
A：可以修改代码中的概率计算部分，但需要理解游戏的实际概率机制。

### Q5：如何添加新的区域或武器？
A：在对应的txt文件中添加新的数据行即可，程序会自动读取。

## 注意事项

1. **文件编码**：所有文本文件建议使用UTF-8编码
2. **分隔符**：wqsx.txt和jz.txt必须使用制表符（Tab）分隔
3. **数据一致性**：确保所有武器名称在wqsx.txt中都有对应的属性
4. **区域完整性**：确保jz.txt包含所有区域的完整属性数据
5. **成本考虑**：出于对成本的考虑，武陵城为其他地区成本的7倍(默认)

## 更新日志

### v1.0.0 (当前版本)
- 初始版本发布
- 支持基本的武器属性匹配和区域优化
- 输出详细的刷取策略表

## 技术支持

如有问题或建议，请：
1. 检查控制台输出的错误信息
2. 确认所有输入文件格式正确
3. 确保Python环境配置正确
4. 如有需要，可以查看程序源码中的详细注释

## 免责声明

本程序为游戏辅助工具，计算结果仅供参考。实际游戏体验可能因游戏版本更新而有所变化，请以游戏内实际情况为准。
