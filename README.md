# 终末地武器基质刷取规划器

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)
![GUI](https://img.shields.io/badge/GUI-Tkinter-orange.svg)

一个为游戏《终末地》设计的智能武器基质刷取规划工具，帮助玩家高效规划武器刷取路径，优化资源分配。

GitHub地址：https://github.com/Astersia-arch/essence-calculator

## ✨ 功能特点

- **智能策略规划**：基于算法自动分析最优刷取区域和属性组合
- **可视化界面**：直观的GUI操作，支持批量选择和筛选
- **多维度分析**：同时考虑主属性、附加属性和技能匹配
- **成本优化**：考虑不同区域的刷取成本，推荐性价比最高的方案
- **数据导出**：自动生成CSV格式的详细刷取计划

## 📁 项目结构

```
essence-calculator/
├── main.py              # 主程序文件
├── weapons.csv          # 武器数据库
├── area.csv            # 区域信息数据库
├── res.csv             # 程序生成的刷取策略（自动生成）
└── README.md           # 说明文档
```

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 所需库：pandas

### 安装运行

1. **克隆项目**
```bash
git clone https://github.com/Astersia-arch/essence-calculator.git
cd essence-calculator
```

2. **安装依赖**
```bash
pip install pandas
```

3. **运行程序**
```bash
python main.py
```

## 📊 数据文件格式

项目已包含完整的数据文件，以下是文件格式说明：

### weapons.csv 格式
包含所有武器的详细信息：

| 类别 | 稀有度 | 名称 | 主属性 | 附加属性 | 技能 |
|------|--------|------|--------|----------|------|
| 单手剑 | 5 | 钢铁余音 | 敏捷 | 物理 | 巧技 |
| 单手剑 | 5 | 坚城铸造者 | 智识 | 终结 | 昂扬 |
| ... | ... | ... | ... | ... | ... |

**字段说明：**
- **类别**：武器类型（如单手剑、双手锤等）
- **稀有度**：武器星级（3-5星）
- **名称**：武器名称
- **主属性**：武器的固定主属性（如：敏捷/智识/力量等组合）
- **附加属性**：武器的附加属性类型
- **技能**：武器的技能类型

### area.csv 格式
包含所有区域的属性池信息：

| 区域 | 附加属性1 | 附加属性2 | 附加属性3 | 附加属性4 | 附加属性5 | 附加属性6 | 附加属性7 | 附加属性8 | 技能1 | 技能2 | 技能3 | 技能4 | 技能5 | 技能6 | 技能7 | 技能8 | 成本 |
|------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-----------|-------|-------|-------|-------|-------|-------|-------|-------|------|
| 枢纽区 | 攻击 | 灼热 | 电磁 | 寒冷 | 自然 | 源石 | 终结技 | 法术 | 强攻 | 压制 | 追袭 | 粉碎 | 巧技 | 迸发 | 流转 | 效益 | 1 |
| 源石研究园 | 攻击 | 物理 | 电磁 | 寒冷 | 自然 | 暴击率 | 终结技 | 法术 | 压制 | 追袭 | 昂扬 | 巧技 | 附术 | 医疗 | 切骨 | 效益 | 1 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... | ... |

**字段说明：**
- **区域**：刷取区域名称
- **附加属性1-8**：该区域可能刷出的附加属性池
- **技能1-8**：该区域可能刷出的技能池
- **成本**：区域刷取成本系数（越低性价比越高）

### res.csv 格式（程序生成）
生成的刷取策略文件：

| 区域 | 主属性1 | 主属性2 | 主属性3 | 附加属性 | 技能 | 次数 | 武器列表 |
|------|---------|---------|---------|----------|------|------|----------|
| 枢纽区 | 力量 | 敏捷 | 智识 | 随机 | 巧技 | 5 | 武器A;武器B;武器C |
| 源石研究园 | 智识 | 力量 | 生命 | 攻击 | 随机 | 3 | 武器D;武器E |

**字段说明：**
- **区域**：推荐的刷取地点
- **主属性1/2/3**：建议锁定的主属性（最多3个）
- **附加属性**：建议锁定的附加属性（显示"随机"表示不固定）
- **技能**：建议锁定的技能（显示"随机"表示不固定）
- **次数**：建议刷取次数
- **武器列表**：该策略涵盖的武器

## 🖥️ 使用指南

### 1. 主界面布局
程序界面分为三个主要区域：
- **左侧**：武器库，显示所有可用武器
- **右上**：已选武器列表
- **右下**：生成的刷取策略

### 2. 操作步骤

1. **加载武器**：程序启动自动加载 weapons.csv 和 area.csv
2. **筛选武器**：
   - 使用顶部的分类筛选器（按类别、稀有度、名称筛选）
   - 使用搜索框进行关键词搜索
3. **选择武器**：
   - 在左侧表格中双击武器或点击"添加选中"按钮
   - 支持多选（Ctrl+点击或Shift+点击）
4. **管理已选**：
   - 右侧表格中可删除单个或清空所有武器
   - 支持Delete键快速删除
5. **生成策略**：
   - 点击"开始计算策略"按钮
   - 查看底部表格中的刷取建议
   - 结果自动保存到 `res.csv`

## ⚙️ 算法原理

### 核心逻辑
1. **属性匹配**：分析武器属性与区域属性的匹配度
2. **分组优化**：将武器按属性相似度分组，减少刷取次数
3. **成本计算**：考虑区域成本系数，优化资源消耗
4. **概率估算**：基于属性和技能组合计算推荐刷取次数

### 评分机制
策略评分 = 覆盖武器数 × 成本系数 × 武器多样性 × (1 + 属性频率权重)

### 刷取次数计算
```
次数 = (武器数量 / 每次掉落数) × 1.5 × 主属性组合数
每次掉落数 = 2
主属性组合数 = C(主属性池大小, 3)
```

## 📝 注意事项

1. **数据更新**：游戏更新后可能需要更新 weapons.csv 和 area.csv 文件
2. **属性命名**：武器和区域的属性名称需保持一致
3. **成本系数**：所有区域目前成本系数均为1.0，如有调整请更新area.csv
4. **结果解读**：建议次数为估算值，实际刷取可能需要根据运气调整
5. **随机属性**：策略中的"随机"表示不固定该属性，刷取时会随机出现

## 🔧 自定义配置

如需调整算法参数，可修改以下部分：

```python
# 在 _find_best_strategy 方法中调整权重
score = coverage * cost_factor * variety * (1 + freq * 0.1)

# 在 _calculate_runs 方法中调整次数计算
drops_per_run = 2  # 每次掉落基质数量
runs = (weapon_count / drops_per_run) * 1.5 * combos  # 1.5为安全系数
```

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 📮 问题反馈

如遇问题或有建议，请：
1. 检查CSV文件格式是否正确
2. 确认Python版本符合要求
3. 在 [GitHub Issues](https://github.com/Astersia-arch/essence-calculator/issues) 中提交问题描述

## 🙏 致谢

感谢所有为《终末地》游戏数据整理做出贡献的玩家！

---
**提示**：本工具为玩家自制，非官方软件，游戏数据请以官方最新版本为准。
